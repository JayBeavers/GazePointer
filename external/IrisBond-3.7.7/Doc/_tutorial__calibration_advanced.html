<!-- HTML header for doxygen 1.8.14-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Irisbond Duo API: Advanced Calibration (using custom GUIs)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="stylesheet.css" rel="stylesheet" type="text/css" />
<link rel="shortcut icon" href="Irisbond.ico" type="image/x-icon" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Irisbond Duo API
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="index.html">notitle</a></li><li class="navelem"><a class="el" href="_tutorial__step_by_step_calibration.html">Step by step calibration</a></li>  </ul>
</div>
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Advanced Calibration (using custom GUIs) </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="Tutorial_CalibrationAdvanced_Intro"></a>
Introduction</h1>
<p>Calibration is a process where the API learns the relationship between the user and the screen, so that it can calculate more precisely where the user is looking. In this process, the user is asked to look at one target moving on the screen and stopping at several locations.</p>
<p>In this tutorial, an advanced calibration using the developer's own GUIs is explained.</p>
<p>The developer may implement the following 3 GUIs for the calibration procedure:</p><ul>
<li>Calibration GUI: shows a target moving on the screen</li>
<li>Calibration error GUI: when the user is not detected while calibrating, a GUI is shown to tell the user that the detection failed. The user can then retry last calibration point or cancel calibration.</li>
<li>Calibration results GUI: when calibration finishes, a GUI with the results is shown.</li>
</ul>
<p>In this tutorial, you will be setting some callbacks. These callbacks are reset each time the Start() function of the API is called. Please, set all callbacks each time and after the Start() function is called.</p>
<h1><a class="anchor" id="Tutorial_CalibrationAdvanced_DisableGUIs"></a>
Disable the default GUIs</h1>
<p>Once the API is running, the first step to start a calibration without the default GUIs is to disable the 3 GUIs: </p><div class="fragment"><div class="line"><a class="code" href="namespace_irisbond_a_p_i.html#a9ed3c3940d8f1c4ffe881b2515b98d3e">showCalibrationGUI</a>(<span class="keyword">false</span>); </div><div class="line"><a class="code" href="namespace_irisbond_a_p_i.html#ab9fb20170d1cac8db6f7cf11254ce0c6">showCalibrationPointErrorGUI</a>(<span class="keyword">false</span>);</div><div class="line"><a class="code" href="namespace_irisbond_a_p_i.html#a787dd27f466841a2221a8960d08fc606">showCalibrationResultsGUI</a>(<span class="keyword">false</span>); </div></div><!-- fragment --><h1><a class="anchor" id="Tutorial_CalibrationAdvanced_CallbacksGUI"></a>
Set the callback for the calibration GUI</h1>
<p>During the calibration, the API will execute a callback function with the position and state of the target on the screen. This state can be "fixed" or "travelling". When calibration starts, the callback will be executed, and the information will be (Point_1, travelling), which means, the target is travelling towards Point_1. Some time after getting this callback, the callback will be executed again, and the information will be (Point_1, fixed), which means, the target has reached Point_1. Some time after, the callback will be executed again, and the information will be (Point_2, travelling), then (Point_2, fixed), and so on until last point.</p>
<p>Following the 3 steps defined in <a class="el" href="_tutorial__getting_gaze_points.html">Getting gaze points and tracking data</a>, the callback function that gets the calibration target position is set as follows:</p>
<div class="fragment"><div class="line"><span class="keyword">public</span> <span class="keywordtype">void</span> fun_calibrationTargetCallback(<span class="keywordtype">double</span> pointX, <span class="keywordtype">double</span> pointY, <span class="keywordtype">int</span> screenWidth, <span class="keywordtype">int</span> screenHeight, <span class="keywordtype">bool</span> fixated)</div><div class="line">{</div><div class="line">    <span class="keywordflow">if</span> (fixated)</div><div class="line">        Console.WriteLine(<span class="stringliteral">&quot;The target is fixated in (&quot;</span> + pointX + <span class="stringliteral">&quot;, &quot;</span> + pointY + <span class="stringliteral">&quot;)&quot;</span> );</div><div class="line">    <span class="keywordflow">else</span></div><div class="line">        Console.WriteLine(<span class="stringliteral">&quot;The target is moving towards (&quot;</span> + pointX + <span class="stringliteral">&quot;, &quot;</span> + pointY + <span class="stringliteral">&quot;)&quot;</span> );</div><div class="line">}</div><div class="line"></div><div class="line">IrisbondDuo.CALIBRATION_TARGET_CALLBACK calibrationTargetCallback = <span class="keyword">new</span> IrisbondDuo.CALIBRATION_TARGET_CALLBACK(fun_calibrationTargetCallback);</div><div class="line"></div><div class="line">IrisbondDuo.setCalibrationTargetCallback(calibrationTargetCallback);</div></div><!-- fragment --><p>Please see <a class="el" href="_tutorial__high_d_p_i_screens.html">High DPI screens</a> for more information about the screen coordinates and the screen size.</p>
<h1><a class="anchor" id="Tutorial_CalibrationAdvanced_CallbacksError"></a>
Set the callback for the calibration error GUI</h1>
<p>During the calibration, the API will execute a callback function when the detection fails in one calibration point. The return value of this function will tell the API to try again that point (true) or to cancel the calibration (false).</p>
<div class="fragment"><div class="line"><span class="keyword">public</span> <span class="keywordtype">bool</span> fun_calibrationPointErrorCallback()</div><div class="line">{</div><div class="line">    DialogResult dialogResult = MessageBox.Show(<span class="stringliteral">&quot;Retry?&quot;</span>, <span class="stringliteral">&quot;User not found&quot;</span>, MessageBoxButtons.RetryCancel);</div><div class="line">    <span class="keywordflow">if</span> (dialogResult == DialogResult.Retry)</div><div class="line">        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line">    <span class="keywordflow">else</span></div><div class="line">        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line">}</div><div class="line"></div><div class="line">IrisbondDuo.CALIBRATION_POINT_ERROR_CALLBACK calibrationPointErrorCallback = <span class="keyword">new</span> IrisbondDuo.CALIBRATION_POINT_ERROR_CALLBACK(fun_calibrationPointErrorCallback);</div><div class="line"></div><div class="line">IrisbondDuo.setCalibrationPointErrorCallback(calibrationPointErrorCallback);</div></div><!-- fragment --><h1><a class="anchor" id="Tutorial_CalibrationAdvanced_CallbacksResults"></a>
Set the callbacks for the calibration results</h1>
<p>When calibration finishes, the API will execute 2 callbacks with the calibration results:</p><ul>
<li>One contains global errors, this means, one error for each eye, as an average of the errors of all calibration points.</li>
<li>One contains more detailed errors for each calibration point.</li>
</ul>
<p>This example shows how to set the first callback and get the global results: </p><div class="fragment"><div class="line"><span class="keyword">public</span> <span class="keywordtype">void</span> fun_calibrationResultsCallback(<span class="keywordtype">double</span> leftPrecisionError, <span class="keywordtype">double</span> leftAccuracyError,</div><div class="line">                                           <span class="keywordtype">double</span> rightPrecisionError, <span class="keywordtype">double</span> rightAccuracyError,</div><div class="line">                                           <span class="keywordtype">double</span> combinedPrecisionError, <span class="keywordtype">double</span> combinedAccuracyError,</div><div class="line">                                           <span class="keywordtype">bool</span> cancelled)</div><div class="line">{</div><div class="line">    Console.WriteLine(<span class="stringliteral">&quot;The left eye accuracy error is &quot;</span> + leftAccuracyError + <span class="stringliteral">&quot;px.&quot;</span>);</div><div class="line">    Console.WriteLine(<span class="stringliteral">&quot;The right eye accuracy error is &quot;</span> + rightAccuracyError + <span class="stringliteral">&quot;px.&quot;</span>);</div><div class="line">    Console.WriteLine(<span class="stringliteral">&quot;The combined accuracy error is &quot;</span> + combinedAccuracyError + <span class="stringliteral">&quot;px.&quot;</span>);</div><div class="line">}</div><div class="line"></div><div class="line">IrisbondDuo.CALIBRATION_RESULTS_CALLBACK calibrationResultsCallback = <span class="keyword">new</span> IrisbondDuo.CALIBRATION_RESULTS_CALLBACK(fun_calibrationResultsCallback);</div><div class="line"></div><div class="line">IrisbondDuo.setCalibrationResultsCallback(calibrationResultsCallback);</div></div><!-- fragment --><p>This example shows how to set the second callback and get the detailed results: </p><div class="fragment"><div class="line"><span class="keyword">public</span> <span class="keywordtype">void</span> fun_calibrationResultsPointsCallback(<span class="keywordtype">int</span> nPoints, IntPtr _xCoords, IntPtr _yCoords,</div><div class="line">                                                 IntPtr _leftErrorsPx, IntPtr _rightErrorsPx, IntPtr _combinedErrorsPx,</div><div class="line">                                                 IntPtr _leftErrorsNorm, IntPtr _rightErrorsNorm, IntPtr _combinedErrorsNorm)</div><div class="line">{</div><div class="line">    <span class="comment">// If rectification is done before calibration, there are no points</span></div><div class="line">    <span class="keywordflow">if</span> (nPoints == 0)</div><div class="line">        <span class="keywordflow">return</span>;</div><div class="line"></div><div class="line">    <span class="comment">// Convert the pointers to vectors as shown in Test.cs</span></div><div class="line">}</div><div class="line"></div><div class="line"></div><div class="line">IrisbondDuo.CALIBRATION_RESULTS_POINTS_CALLBACK calibrationResultsPointsCallback = <span class="keyword">new</span> IrisbondDuo.CALIBRATION_RESULTS_POINTS_CALLBACK(fun_calibrationResultsPointsCallback);</div><div class="line"></div><div class="line">IrisbondDuo.setCalibrationResultsPointsCallback(calibrationResultsPointsCallback);</div></div><!-- fragment --><h1><a class="anchor" id="Tutorial_CalibrationAdvanced_CallbacksCancelled"></a>
Set the callback for the calibration cancellation</h1>
<p>During the calibration, the user can cancel the process by pressing the Escape key (or other key defined by the application). To make sure that the developer gets that event, a callback is executed when the calibration finishes early.</p>
<p>This example shows how to set the callback function to know when that event happens:</p>
<div class="fragment"><div class="line"><span class="keyword">public</span> <span class="keywordtype">void</span> fun_calibrationCancelledCallback()</div><div class="line">{</div><div class="line">    Console.WriteLine(<span class="stringliteral">&quot;Calibration Cancelled&quot;</span>);</div><div class="line">}</div><div class="line"></div><div class="line">IrisbondDuo.CALIBRATION_CANCELLED_CALLBACK calibrationCancelledCallback = <span class="keyword">new</span> IrisbondDuo.CALIBRATION_CANCELLED_CALLBACK(fun_calibrationCancelledCallback);</div><div class="line"></div><div class="line">IrisbondDuo.setCalibrationCancelledCallback(calibrationCancelledCallback);</div></div><!-- fragment --><h1><a class="anchor" id="Tutorial_CalibrationAdvanced_StartCalibration"></a>
Start calibration</h1>
<p>Before starting the calibration, the target travel and fixation times can be configured. Since the default times may be slow for advanced users, and fast for difficult users, the developer can change these two variables according to the user. </p><div class="fragment"><div class="line">IrisbondDuo.setCalibrationParameters(2, 1); <span class="comment">// Travel for 2 seconds, stay fixated for 1 second</span></div></div><!-- fragment --><p>To start calibrating, the 2 following functions must be called: </p><div class="fragment"><div class="line">IrisbondDuo.startCalibration(9);         <span class="comment">// 2, 3, 5, 9 or 16</span></div><div class="line">IrisbondDuo.waitForCalibrationToEnd(1);</div></div><!-- fragment --><p><a class="el" href="namespace_irisbond_a_p_i.html#a85b5f7036c92498130a91a391655a3dd" title="Start a calibration process to adapt the eye tracker to the user&#39;s eyes. waitForCalibrationToEnd() mu...">IrisbondAPI::startCalibration</a> takes as an argument the number of calibration points, that can be 2, 3, 5, 9 or 16. The more points, the more accurate the tracker can be.</p>
<p><a class="el" href="namespace_irisbond_a_p_i.html#a61a39af50f0c79d77d7f892895b01a9e" title="Wait during the calibration processes until they finish.">IrisbondAPI::waitForCalibrationToEnd</a> blocks the thread and waits until the calibration finishes.</p>
<h1><a class="anchor" id="Tutorial_CalibrationAdvanced_CancelCalibration"></a>
Cancel calibration</h1>
<p>During calibration, the process can be aborted programmatically just by calling </p><div class="fragment"><div class="line">IrisbondDuo.cancelCalibration();</div></div><!-- fragment --><h1><a class="anchor" id="Tutorial_CalibrationAdvanced_CalibrationError"></a>
Other calibration actions</h1>
<p>So far, the calibration consists of N points on the screen, where N can be 2, 3, 5, 9 or 16. This calibration should be done at least once to provide a good user experience.</p>
<p>There are, however, two more actions related to the calibration:</p><ul>
<li>Calibration improvement</li>
<li>Calibration rectification</li>
</ul>
<p>Calibration improvement makes a fast 3-point calibration, in order to improve the worst 3 points learnt in the previous calibration. This action can be done after a 5, 9 or 16-point calibration.</p>
<div class="fragment"><div class="line">IrisbondDuo.startImproveCalibration();</div><div class="line">IrisbondDuo.waitForCalibrationToEnd(1);</div></div><!-- fragment --><p>The callbacks defined in previous sections apply to the calibration improvement as well.</p>
<p>Calibration rectification makes a fast 1-point calibration, in order to rectify in a global way the previous calibration, instead of a point-detailed way.</p>
<div class="fragment"><div class="line">IrisbondDuo.startCalibrationRectification();</div><div class="line">IrisbondDuo.waitForCalibrationToEnd(1);</div></div><!-- fragment --> </div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- HTML footer for doxygen 1.8.14-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.15
</small></address>
</body>
</html>
